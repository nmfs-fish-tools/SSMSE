<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="An R package for performing Management Strategy Evaluation
    (MSE) using Stock Synthesis (SS). SS is used as the Operating Model
    (OM) and, if the user desires, the Estimation model (EM). SSMSE allows
    existing SS models to be used as the basis for an OM. These OMs are
    used in the MSE framework provided by SSMSE to evaluate the
    implications of management actions on a population given uncertainty.">
<title>Management Strategy Evaluation (MSE) using Stock Synthesis (SS) • SSMSE</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="Management Strategy Evaluation (MSE) using Stock Synthesis (SS)">
<meta property="og:description" content="An R package for performing Management Strategy Evaluation
    (MSE) using Stock Synthesis (SS). SS is used as the Operating Model
    (OM) and, if the user desires, the Estimation model (EM). SSMSE allows
    existing SS models to be used as the basis for an OM. These OMs are
    used in the MSE framework provided by SSMSE to evaluate the
    implications of management actions on a population given uncertainty.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">SSMSE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://nmfs-fish-tools.github.io/SSMSE/manual" aria-label="User Manual">User Manual</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nmfs-fish-tools/SSMSE/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="ssmse-management-strategy-evaluation-for-stock-synthesis">SSMSE: Management Strategy Evaluation for Stock Synthesis<a class="anchor" aria-label="anchor" href="#ssmse-management-strategy-evaluation-for-stock-synthesis"></a>
</h1></div>
<ul>
<li><a href="#ssmse-build-status">SSMSE build status</a></li>
<li><a href="#current-support-level-for-ssmse">Current support level for SSMSE</a></li>
<li><a href="#motivation-for-developing-ssmse">Motivation for developing SSMSE</a></li>
<li><a href="#how-to-cite-ssmse">How to cite SSMSE</a></li>
<li><a href="#need-help">Need Help?</a></li>
<li><a href="#installing-the-ssmse-r-package">Installing the SSMSE R package</a></li>
<li><a href="#troubleshooting-installation">Troubleshooting Installation</a></li>
<li>
<a href="#an-ssmse-example">An SSMSE example</a>
<ul>
<li><a href="#setup-r-workspace-folders">Setup R workspace folders</a></li>
<li><a href="#create-the-operating-models-oms">Create the operating models (OMs)</a></li>
<li><a href="#adding-process-error-through-recruitment-deviations-and-time-varying-selectivity">Adding process error through recruitment deviations and time-varying selectivity</a></li>
<li><a href="#examine-the-management-procedure-used">Examine the management procedure used</a></li>
<li><a href="#run-ssmse">Run SSMSE</a></li>
<li><a href="#run_ssmse-output">run_SSMSE output</a></li>
<li><a href="#performance-metrics">Performance metrics</a></li>
<li><a href="#summarize-results">Summarize results</a></li>
<li><a href="#simple-convergence-check">Simple Convergence Check</a></li>
<li><a href="#plot-spawning-stock-biomass-ssb">Plot Spawning Stock Biomass (SSB)</a></li>
<li><a href="#example-mse-results">Example MSE Results</a></li>
<li><a href="#delete-the-files">Delete the files</a></li>
</ul>
</li>
<li><a href="#advanced-options-use-a-custom-management-strategyprocedure">Advanced options: use a custom management strategy/procedure</a></li>
<li><a href="#how-can-i-contribute-to-ssmse">How can I contribute to SSMSE?</a></li>
<li><a href="#roadmap-where-is-ssmse-headed-next">Roadmap: Where is SSMSE headed next?</a></li>
</ul>
<!-- README.md is generated from README.Rmd. Please edit README.Rmd --><p><img src="reference/figures/ssmse_icon_small.png"></p>
</div>
<div class="section level1">
<h1 id="ssmse-build-status">SSMSE build status<a class="anchor" aria-label="anchor" href="#ssmse-build-status"></a>
</h1>
<p><a href="https://github.com/nmfs-fish-tools/SSMSE/actions/workflows/call-r-cmd-check.yml" class="external-link"><img src="https://github.com/nmfs-fish-tools/SSMSE/actions/workflows/call-r-cmd-check.yml/badge.svg" alt="badge for the github action call-r-cmd-check"></a> <a href="https://codecov.io/gh/nmfs-fish-tools/SSMSE" class="external-link"><img src="https://codecov.io/gh/nmfs-fish-tools/SSMSE/branch/master/graph/badge.svg" alt="codecoverage badge"></a> <a href="https://doi.org/10.21105/joss.04937" class="external-link"><img src="https://joss.theoj.org/papers/10.21105/joss.04937/status.svg" alt="DOI badge"></a> <a href="https://lifecycle.r-lib.org/articles/stages.html" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-green.svg" alt="Lifecycle badge indicating this repository is stable"></a></p>
</div>
<div class="section level1">
<h1 id="current-support-level-for-ssmse">Current support level for SSMSE<a class="anchor" aria-label="anchor" href="#current-support-level-for-ssmse"></a>
</h1>
<p>SSMSE is not currently being actively developed. SSMSE is being maintained for bugs fixes only - bug fixes will be addressed, but suggestions for new features and enhancements will not. Changes in staffing in the future could support more active development.</p>
<hr>
<p><strong>Disclaimer</strong></p>
<p>“The United States Department of Commerce (DOC) GitHub project code is provided on an ‘as is’ basis and the user assumes responsibility for its use. DOC has relinquished control of the information and no longer has responsibility to protect the integrity, confidentiality, or availability of the information. Any claims against the Department of Commerce stemming from the use of its GitHub project will be governed by all applicable Federal law. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation or favoring by the Department of Commerce. The Department of Commerce seal and logo, or the seal and logo of a DOC bureau, shall not be used in any manner to imply endorsement of any commercial product or activity by DOC or the United States Government.”</p>
<hr>
</div>
<div class="section level1">
<h1 id="motivation-for-developing-ssmse">Motivation for developing SSMSE<a class="anchor" aria-label="anchor" href="#motivation-for-developing-ssmse"></a>
</h1>
<p>This package was developed to increase the ease of using the stock assessment software Stock Synthesis (SS3) directly as an operating model (OM) in Management Strategy Evaluation (MSE). The approach requires a conditioned Stock Synthesis mode to use as the OM. The intended users are those who conduct MSEs.</p>
<p>Below, we’ll work through a simple example MSE as a way of introducing the SSMSE package. An additional example is included in the <a href="https://doi.org/10.21105/joss.04937" class="external-link">Journal Of Open Source Software SSMSE paper</a>.</p>
</div>
<div class="section level1">
<h1 id="how-to-cite-ssmse">How to cite SSMSE<a class="anchor" aria-label="anchor" href="#how-to-cite-ssmse"></a>
</h1>
<p>Doering et al., (2023). SSMSE: An R package for Management Strategy Evaluation with Stock Synthesis Operating Models. Journal of Open Source Software, 8(90), 4937, <a href="https://doi.org/10.21105/joss.04937" class="external-link uri">https://doi.org/10.21105/joss.04937</a></p>
</div>
<div class="section level1">
<h1 id="need-help">Need Help?<a class="anchor" aria-label="anchor" href="#need-help"></a>
</h1>
<ul>
<li>Get questions answered in <a href="https://github.com/nmfs-fish-tools/SSMSE/discussions" class="external-link">discussions</a>.</li>
<li>Submit bug reports and feature requests to <a href="https://github.com/nmfs-fish-tools/SSMSE/issues" class="external-link">issues</a>.</li>
<li>Alternatively, contact the develpers via email at <a href="mailto:nmfs.stock.synthesis@noaa.gov" class="email">nmfs.stock.synthesis@noaa.gov</a>.</li>
</ul>
</div>
<div class="section level1">
<h1 id="installing-the-ssmse-r-package">Installing the SSMSE R package<a class="anchor" aria-label="anchor" href="#installing-the-ssmse-r-package"></a>
</h1>
<p>To install SSMSE from github:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"nmfs-fish-tools/SSMSE"</span><span class="op">)</span></span></code></pre></div>
<p>You can read the help files with</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">SSMSE</span></span></code></pre></div>
<p>Note that when SSMSE is installed, <a href="https://github.com/nmfs-ost/ss3-source-code" class="external-link">Stock Synthesis</a> binaries are included in the <code>SSMSE/bin/</code> folder downloaded to the user’s local R library. Currently, the Stock Synthesis 3.30.18 is included. Separate binaries are included for Windows, Mac and Linux. Users may swap out these binaries, but SSMSE is not tested with other versions of SS3.</p>
</div>
<div class="section level1">
<h1 id="troubleshooting-installation">Troubleshooting Installation<a class="anchor" aria-label="anchor" href="#troubleshooting-installation"></a>
</h1>
<p>Here are some tips:</p>
<ul>
<li>Make sure you are using the main branch versions of R packages <code>r4ss</code> and <code>ss3sim</code>. These can be installed separately using <code>remotes::install_github("r4ss/r4ss")</code> and <code>remotes::install_github("ss3sim/ss3sim")</code>.</li>
<li>If R asks “Would you like to download from sources that need compilation?”, select “no”, as the older compiled versions should work fine.</li>
<li>If R asks which packages you would like to update, select “none.” Although it is good to update to keep packages current, install can sometimes be frustrating when updating many packages and skipping this step can eliminate issues in the short term.</li>
<li>If running into an error during install, try closing out all R sessions open (e.g., other R GUI or R studio windows), restarting the R session and trying <code>remotes::install_github("nmfs-fish-tools/SSMSE")</code> again.</li>
<li>If still running into an error during install, and it seems to be a problem installing a particular package, try restarting the R session, using <code><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages()</a></code> to download the package that caused the error, restarting the R session, and trying <code>remotes::install_github("nmfs-fish-tools/SSMSE")</code> again. This step may need to be done several times for different R packages.</li>
</ul>
<p>Still having trouble installing SSMSE? Please don’t hesitate to <a href="https://github.com/nmfs-fish-tools/SSMSE/discussions/categories/q-a" class="external-link">post in discussions about the issue</a>.</p>
</div>
<div class="section level1">
<h1 id="an-ssmse-example">An SSMSE example<a class="anchor" aria-label="anchor" href="#an-ssmse-example"></a>
</h1>
<p>Suppose we want to look at how well we are able to achieve a performance metric under uncertainty in the operating model (OM). We will look 2 scenarios, one where Steepness (h) is specified correctly and one where it is specified incorrectly in an estimation model (EM):</p>
<p>Scenario 1. <strong>h-ctl</strong>: Cod operating model (h = 0.65) with correctly specified cod model EM (fixed h = 0.65). The OM is the same as the EM.</p>
<p>Scenario 2. <strong>h-1</strong>: Cod operating model (h = 1) with misspecified cod model EM (fixed h = 0.65); The OM is not the same as the EM.</p>
<p>Note that this is a simple example where the OM and EM structures for both scenarios are identical, except for different steepness between the OM and EM in scenario 2 and some process error we will include in the operating model. We will assume we want to run the MSE loop for 6 years, with a stock assessment occuring every 3 years (and forecasting catch to maintain 40% of unfished spawning stock biomass). The cod model’s last year is 100, so the OM is initially conditioned through year 100. Then, after conditioning the operating model through year 100, assessments will occur in years 100 and 103. The operating model runs through year 106. We chose not to run the assessment in year 106, as there was no need for its output in this example.</p>
<div class="section level2">
<h2 id="setup-r-workspace-folders">Setup R workspace folders<a class="anchor" aria-label="anchor" href="#setup-r-workspace-folders"></a>
</h2>
<p>First, we will load the <code>SSMSE</code> package and create a folder in which to run the example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nmfs-fish-tools/SSMSE" class="external-link">SSMSE</a></span><span class="op">)</span> <span class="co"># load the package</span></span>
<span><span class="co">## Welcome to SSMSE version 0.2.8 using Stock Synthesis 3.30.18.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r4ss/r4ss" class="external-link">r4ss</a></span><span class="op">)</span> <span class="co"># install using remotes::install_github("r4ss/r4ss)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'r4ss'</span></span>
<span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     profile</span></span>
<span><span class="co">## The following object is masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     jitter</span></span>
<span><span class="co"># library(foreach) #if using run_parallel = TRUE</span></span>
<span><span class="co"># library(doParallel) #if using run_parallel = TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a folder for the output in the working directory.</span></span>
<span><span class="va">run_SSMSE_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"run_SSMSE-ex"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">run_SSMSE_dir</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-the-operating-models-oms">Create the operating models (OMs)<a class="anchor" aria-label="anchor" href="#create-the-operating-models-oms"></a>
</h2>
<div class="section level3">
<h3 id="specify-alternative-values-for-h">Specify alternative values for h<a class="anchor" aria-label="anchor" href="#specify-alternative-values-for-h"></a>
</h3>
<p>The cod model with h = 0.65 (as in scenario 1) is included as external package data in SSMSE. However, we will need to modify it to use as an operating model with h = 1 (as in scenario 2). Note in this case that refit_OM is false, so the model is not being refit, just run through without fitting. To condition the new model on the same data as the input model, refit_OM should be TRUE.</p>
<p>First, we identify where the base cod model is stored, modify it such that the steepness parameter is 1, and save the modified cod OM for scenario 2 in a new folder in the <code>run_SSMSE_dir</code> directory.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cod_mod_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"models"</span>, <span class="st">"cod"</span>, package <span class="op">=</span> <span class="st">"SSMSE"</span><span class="op">)</span></span>
<span><span class="co"># develop_OMs will save a model called "cod_SR_BH_steep_1" in the out_dir</span></span>
<span><span class="co"># specified</span></span>
<span><span class="fu"><a href="reference/develop_OMs.html">develop_OMs</a></span><span class="op">(</span></span>
<span>  OM_name <span class="op">=</span> <span class="st">"cod"</span>, out_dir <span class="op">=</span> <span class="va">run_SSMSE_dir</span>, par_name <span class="op">=</span> <span class="st">"SR_BH_steep"</span>,</span>
<span>  par_vals <span class="op">=</span> <span class="fl">1</span>, refit_OMs <span class="op">=</span> <span class="cn">FALSE</span>, hess <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># OM model for scenario 2</span></span>
<span><span class="va">cod_1_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">run_SSMSE_dir</span>, <span class="st">"cod_SR_BH_steep_1"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="adding-process-error-through-recruitment-deviations-and-time-varying-selectivity">Adding process error through recruitment deviations and time-varying selectivity<a class="anchor" aria-label="anchor" href="#adding-process-error-through-recruitment-deviations-and-time-varying-selectivity"></a>
</h2>
<p>Recruitment deviations, implementation error, and changes in parameters in the projection period of the OM can be added through the <code>future_om_list</code> input to <code>run_SSMSE</code>.</p>
<p>First, we’ll set up the list to add recruitment deviations in the projection period. The same recruitment deviation patterns are used across scenarios, but different patterns are use across iterations in the same scenario. We also want these deviations to have the same standard deviations as the historical deviations with 0 mean (the assumed default).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start from a list created by a helper function</span></span>
<span><span class="va">template_mod_change</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_future_om_list.html">create_future_om_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># add recruitment deviations</span></span>
<span><span class="va">rec_dev_specify</span> <span class="op">&lt;-</span> <span class="va">template_mod_change</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">rec_dev_specify</span><span class="op">$</span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="st">"rec_devs"</span> <span class="co"># apply change to rec devs</span></span>
<span><span class="va">rec_dev_specify</span><span class="op">$</span><span class="va">scen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"replicate"</span>, <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="co"># using 1 to 100 means the sd or mean will be calculated by taking the sd across years</span></span>
<span><span class="co"># from 1 to 100</span></span>
<span><span class="va">rec_dev_specify</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">first_yr_averaging</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">rec_dev_specify</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">last_yr_averaging</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="co"># The following 2 lines suggest that this change is immediately applied in year</span></span>
<span><span class="co"># 101, with no transitory period for using sd 0 to the new sd.</span></span>
<span><span class="va">rec_dev_specify</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">last_yr_orig_val</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">rec_dev_specify</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">first_yr_final_val</span> <span class="op">&lt;-</span> <span class="fl">101</span></span>
<span><span class="va">rec_dev_specify</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">ts_param</span> <span class="op">&lt;-</span> <span class="st">"sd"</span> <span class="co"># this change is for the sd</span></span>
<span><span class="co"># no input value needed since it will be calclated from the historical rec devs.</span></span>
<span><span class="va">rec_dev_specify</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">rec_dev_specify</span></span>
<span><span class="co">## $pars</span></span>
<span><span class="co">## [1] "rec_devs"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $scen</span></span>
<span><span class="co">## [1] "replicate" "all"      </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $pattern</span></span>
<span><span class="co">## [1] "model_change"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $input</span></span>
<span><span class="co">##   first_yr_averaging last_yr_averaging last_yr_orig_val first_yr_final_val</span></span>
<span><span class="co">## 1                  1               100              100                101</span></span>
<span><span class="co">##   ts_param   method value</span></span>
<span><span class="co">## 1       sd absolute    NA</span></span></code></pre></div>
<p>Next, suppose we want to allow selectivity to vary annually for 1 selectivity parameter of the fishery throughout the projection period. The following specifies that the value for selectivity varies randomly around the base value with a sd of 0.2.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># put together the change for selectivity (random values around the orig val, with</span></span>
<span><span class="co"># an sd of 0.2)</span></span>
<span><span class="va">mod_change_sel</span> <span class="op">&lt;-</span> <span class="va">template_mod_change</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">mod_change_sel</span><span class="op">$</span><span class="va">scen</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"all"</span> <span class="co"># apply to all scenarios</span></span>
<span><span class="co"># The following 2 lines suggest that this change is immediately applied in year</span></span>
<span><span class="co"># 101, with no transitory period for using sd 0 to the new sd.</span></span>
<span><span class="co"># historical values are NA in this case, because they are not used to determine</span></span>
<span><span class="co"># the sd to use.</span></span>
<span><span class="va">mod_change_sel</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">last_yr_orig_val</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">mod_change_sel</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">first_yr_final_val</span> <span class="op">&lt;-</span> <span class="fl">101</span></span>
<span><span class="va">mod_change_sel</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">ts_param</span> <span class="op">&lt;-</span> <span class="st">"sd"</span> <span class="co"># this change is for the sd</span></span>
<span><span class="va">mod_change_sel</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fl">0.2</span> <span class="co"># se to use in the projection period</span></span>
<span><span class="va">mod_change_sel</span></span>
<span><span class="co">## $pars</span></span>
<span><span class="co">## [1] "SizeSel_P_3_Fishery(1)"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $scen</span></span>
<span><span class="co">## [1] "replicate" "all"      </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $pattern</span></span>
<span><span class="co">## [1] "model_change"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $input</span></span>
<span><span class="co">##   first_yr_averaging last_yr_averaging last_yr_orig_val first_yr_final_val</span></span>
<span><span class="co">## 1                 NA                NA              100                101</span></span>
<span><span class="co">##   ts_param   method value</span></span>
<span><span class="co">## 1       sd absolute   0.2</span></span></code></pre></div>
<p>Finally, add these two changes together into an object to pass to <code>run_SSMSE</code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">future_om_list_recdevs_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">rec_dev_specify</span>,</span>
<span>  <span class="va">mod_change_sel</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="add-observation-error-through-sampling-from-om">Add observation error through sampling from OM<a class="anchor" aria-label="anchor" href="#add-observation-error-through-sampling-from-om"></a>
</h3>
<p>The argument <code>sample_struct</code> specifies the structure for sampling from the OM (and passing to the EM). The function <code>create_sample_struct</code> can be used to construct a simple sampling structure consistent with an input data file:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"models"</span>, <span class="st">"cod"</span>, <span class="st">"ss3.dat"</span>, package <span class="op">=</span> <span class="st">"SSMSE"</span><span class="op">)</span></span>
<span><span class="va">sample_struct_1_scen</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_sample_struct.html">create_sample_struct</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">datfile</span>, nyrs <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="co"># note warning</span></span>
<span><span class="co">## Warning in FUN(X[[i]], ...): Pattern not found for lencomp: FltSvy 1, Seas 1.</span></span>
<span><span class="co">## Returning NA for Yr in this dataframe.</span></span>
<span><span class="va">sample_struct_1_scen</span></span>
<span><span class="co">## $catch</span></span>
<span><span class="co">##    Yr Seas FltSvy    SE</span></span>
<span><span class="co">## 1 101    1      1 0.005</span></span>
<span><span class="co">## 2 102    1      1 0.005</span></span>
<span><span class="co">## 3 103    1      1 0.005</span></span>
<span><span class="co">## 4 104    1      1 0.005</span></span>
<span><span class="co">## 5 105    1      1 0.005</span></span>
<span><span class="co">## 6 106    1      1 0.005</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $CPUE</span></span>
<span><span class="co">##    Yr Seas FltSvy  SE</span></span>
<span><span class="co">## 1 105    7      2 0.2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $lencomp</span></span>
<span><span class="co">##   Yr Seas FltSvy Sex Part Nsamp</span></span>
<span><span class="co">## 1 NA    1      1   0    0   125</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $agecomp</span></span>
<span><span class="co">##    Yr Seas FltSvy Sex Part Ageerr Lbin_lo Lbin_hi Nsamp</span></span>
<span><span class="co">## 1 105    1      2   0    0      1      -1      -1   500</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $meanbodywt</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $MeanSize_at_Age_obs</span></span>
<span><span class="co">## [1] NA</span></span></code></pre></div>
<p>By default, <code>create_sample_struct</code> identifies sampling patterns from the historical period of the OM and replicates those patterns in the projection period. In our cod example, the sample structure specifies that catch will be added to the estimation model every year (years 101 to 106), but an index of abundance (i.e., CPUE) and age composition (i.e., agecomp) will only be added in year 105. We will use the same sampling scheme for both scenarios, but it is possible to specify different sampling for each scenario. The user could modify this sampling strategy (for example, maybe age composition should also be sampled from FltSvy 2 in Yr 102; the user could add another line to the dataframe in <code>sample_struct$agecomp</code>).</p>
<p>Note that length comp (lencomp) includes an <code>NA</code> value for year. This is because no consistent pattern was identified, so the user must define their own input. In this case, we will remove sampling length comps all together:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_struct_1_scen</span><span class="op">$</span><span class="va">lencomp</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># don't use length sampling</span></span></code></pre></div>
<p>The same sampling structure will be used for both scenarios, which we define in a list below:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_struct_list_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"h-ctl"</span> <span class="op">=</span> <span class="va">sample_struct_1_scen</span>, <span class="st">"h-1"</span> <span class="op">=</span> <span class="va">sample_struct_1_scen</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="examine-the-management-procedure-used">Examine the management procedure used<a class="anchor" aria-label="anchor" href="#examine-the-management-procedure-used"></a>
</h2>
<p>We will use the same management procedure for both scenarios:</p>
<ol style="list-style-type: decimal">
<li>Conduct a stock assessment every 3 years to get stock status.</li>
<li>Project from this stock assessment using the SS3 forecast file to get projected future catch.</li>
<li>Put this projected catch (without implementation error, in the case of this example) back into the OM. Extend the OM forward in time to get the true values for the population.</li>
</ol>
<p>Let’s take a look at step 2 in the management procedure, which is implemented using the forecasting module in SS. We will examine the forecast file for the estimation model to better understand how catches will be forecasted from the assessment. We will use the same management procedure in both of these scenarios, although for a full MSE analysis, it is likely that multiple management procedures would be compared.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fore</span> <span class="op">&lt;-</span> <span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_readforecast.html" class="external-link">SS_readforecast</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"models"</span>, <span class="st">"cod"</span>, <span class="st">"forecast.ss"</span>, package <span class="op">=</span> <span class="st">"SSMSE"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fore</span><span class="op">$</span><span class="va">Forecast</span></span>
<span><span class="co">## [1] 3</span></span>
<span><span class="va">fore</span><span class="op">$</span><span class="va">Btarget</span></span>
<span><span class="co">## [1] 0.4</span></span></code></pre></div>
<p><code>fore$Forecast = 3</code> means our forecasts from the assessment will use fishing mortality (F) to attmpt to achieve a relative (to unfished) spawning stock biomass. Based on <code>fore$Btarget</code>, the relative biomass target is 40% of unfished spawning stock biomass. Note also that the control rule <code>fore$BforconstantF</code> and <code>fore$BfornoF</code> values are set low to make it unlikely that they will be used (these parameters are used for a ramp harvest control rule, which we do not want to use here):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fore</span><span class="op">$</span><span class="va">BforconstantF</span></span>
<span><span class="co">## [1] 0.03</span></span>
<span><span class="va">fore</span><span class="op">$</span><span class="va">BfornoF</span></span>
<span><span class="co">## [1] 0.01</span></span></code></pre></div>
<p>Futhermore, <code>fore$Flimitfraction</code> is set to 1 so that the forecasted catch is set equal to the overfishing limit (for simplicity):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fore</span><span class="op">$</span><span class="va">Flimitfraction</span></span>
<span><span class="co">## [1] 1</span></span></code></pre></div>
<p>Note that the number of forecast years is 1:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fore</span><span class="op">$</span><span class="va">Nforecastyrs</span></span>
<span><span class="co">## [1] 1</span></span></code></pre></div>
<p>However, an assessment will be conducted every 3 years and thus 3 years of projections is required. SSMSE will automatically modify this value in the estimation model to the appropriate number of forecasting years.</p>
<p>More information on using the forecast module in SS3 to forecast catches is available in the <a href="https://vlab.noaa.gov/web/stock-synthesis/document-library/-/document_library/0LmuycloZeIt/view/4513132" class="external-link">Stock Synthesis users manual</a>.</p>
<p>Users can also specify their own <a href="https://nmfs-fish-tools.github.io/SSMSE/manual/custom-MS.html" class="external-link">custom management procedures</a>.</p>
</div>
<div class="section level2">
<h2 id="run-ssmse">Run SSMSE<a class="anchor" aria-label="anchor" href="#run-ssmse"></a>
</h2>
<p>Now, we create a directory to store our results, and use <code>run_SSMSE</code> to run the MSE analysis loop (note this will take some time to run, ~ 20 min):</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run_res_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">run_SSMSE_dir</span>, <span class="st">"results"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">run_res_path</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_SSMSE.html">run_SSMSE</a></span><span class="op">(</span></span>
<span>  scen_name_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"h-ctl"</span>, <span class="st">"h-1"</span><span class="op">)</span>, <span class="co"># name of the scenario</span></span>
<span>  out_dir_scen_vec <span class="op">=</span> <span class="va">run_res_path</span>, <span class="co"># directory in which to run the scenario</span></span>
<span>  iter_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, <span class="co"># run with 5 iterations each</span></span>
<span>  OM_name_vec <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># specify directories instead</span></span>
<span>  OM_in_dir_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cod_mod_path</span>, <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="va">cod_1_path</span><span class="op">)</span><span class="op">)</span>, <span class="co"># OM files</span></span>
<span>  EM_name_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cod"</span>, <span class="st">"cod"</span><span class="op">)</span>, <span class="co"># cod is included in package data</span></span>
<span>  MS_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EM"</span>, <span class="st">"EM"</span><span class="op">)</span>, <span class="co"># The management strategy is specified in the EM</span></span>
<span>  nyrs_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span>, <span class="co"># Years to project OM forward</span></span>
<span>  nyrs_assess_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, <span class="co"># Years between assessments</span></span>
<span>  future_om_list <span class="op">=</span> <span class="va">future_om_list_recdevs_sel</span>,</span>
<span>  run_parallel <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># Run iterations in parallel</span></span>
<span>  sample_struct_list <span class="op">=</span> <span class="va">sample_struct_list_all</span>, <span class="co"># How to sample data for running the EM.</span></span>
<span>  sample_struct_hist_list <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># because this is null, will just use sampling</span></span>
<span>  <span class="co"># as in the current OM data file for the historical period.</span></span>
<span>  seed <span class="op">=</span> <span class="fl">12345</span></span>
<span><span class="op">)</span> <span class="co"># Set a fixed integer seed that allows replication</span></span></code></pre></div>
<p>See <code><a href="reference/run_SSMSE.html">?run_SSMSE</a></code> for more details on function arguments. In a real MSE analysis, running 100+ iterations to reflect the full range of uncertainty (given observation and process errors) in the results would be preferred. However, we are only running 5 iterations per scenario in this demonstration to reduce computing time.</p>
</div>
<div class="section level2">
<h2 id="run_ssmse-output">run_SSMSE output<a class="anchor" aria-label="anchor" href="#run_ssmse-output"></a>
</h2>
<p><code>run_SSMSE</code> will create new folders in the folders specified in <code>out_dir_scen_vec</code> (note that in this case, we are running both scenarios in the same folder). After is complete, there will be a folder for each scenario in <code>run_res_path</code> (since <code>out_dir_scen_vec = run_res_path</code> in this example):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.dirs</a></span><span class="op">(</span><span class="va">run_res_path</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## [1] "run_SSMSE-ex/results/h-1"   "run_SSMSE-ex/results/h-ctl"</span></span></code></pre></div>
<p>Within each scenario is a folder for each scenario:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># See folders for scenario 1.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.dirs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">run_res_path</span>, <span class="st">"h-ctl"</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## [1] "run_SSMSE-ex/results/h-ctl/1" "run_SSMSE-ex/results/h-ctl/2"</span></span>
<span><span class="co">## [3] "run_SSMSE-ex/results/h-ctl/3" "run_SSMSE-ex/results/h-ctl/4"</span></span>
<span><span class="co">## [5] "run_SSMSE-ex/results/h-ctl/5"</span></span></code></pre></div>
<p>And within each scenario folder, there are folders containing the SS3 models that were run by <code>run_SSMSE</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># see folders for the first iteration of scenario 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.dirs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">run_res_path</span>, <span class="st">"h-ctl"</span>, <span class="st">"1"</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## [1] "run_SSMSE-ex/results/h-ctl/1/cod_EM_103" </span></span>
<span><span class="co">## [2] "run_SSMSE-ex/results/h-ctl/1/cod_EM_init"</span></span>
<span><span class="co">## [3] "run_SSMSE-ex/results/h-ctl/1/cod_OM"</span></span></code></pre></div>
<p>There should be 1 folder for the OM, which is run multiple times in this same folder during the MSE analysis. There are multiple folders for the EMs, as a new folder is created each time an assessment is done. The first run is the folder with a name ending in <code>init</code>; then, each assessment after is named for the updated end year of the model.</p>
<p>With many iterations, the number of files adds up; in the future, we hope to add options to save less output.</p>
</div>
<div class="section level2">
<h2 id="performance-metrics">Performance metrics<a class="anchor" aria-label="anchor" href="#performance-metrics"></a>
</h2>
<p>Quantitative performance metrics should be specified before conducting an MSE. Typically, a suite of performance metrics will be examined; however, for simplicity in this example, we will only look at what the achieved relative biomass was for the last 3 years of projection in the MSE to determine how it compares to the intended management target of 40% of unfished Spawning Stock Biomass. Note that we are only running our MSE projection for 6 years, but longer projections are typical in MSE analyses.</p>
</div>
<div class="section level2">
<h2 id="summarize-results">Summarize results<a class="anchor" aria-label="anchor" href="#summarize-results"></a>
</h2>
<p>The function <code>SSMSE_summary_all</code> can be used to summarize the model results in a list of 3 dataframes, one for scalar outputs (named <code>scalar</code>), one for timeseries outputs (<code>ts</code>), one for derived quantities (<code>dq</code>). This function also creates summary csv files in the folder where the results are stored.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize 1 iteration of output</span></span>
<span><span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/SSMSE_summary_all.html">SSMSE_summary_all</a></span><span class="op">(</span><span class="va">run_res_path</span><span class="op">)</span></span>
<span><span class="co">## Extracting results from 2 scenarios</span></span>
<span><span class="co">## Starting h-1 with 5 iterations</span></span>
<span><span class="co">## Starting h-ctl with 5 iterations</span></span></code></pre></div>
<p>Plotting and data manipulation can then be done with these summaries. For example, SSB over time by model can be plotted. The models include the Operating Model (cod_OM), Estimation model (EM) for the historical period of years 0-100 (cod_EM_init), and the EM run with last year of data in year 103 (cod_EM_103). The operating models are shown in blue or black (depending on the scenario), and the estimation model runs are shown in orange, and the scenarios are shown on different subplots:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># use install.packages("ggplot2") to install package if needed</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span> <span class="co"># use install.packages("tidyr") to install package if needed</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># use install.packages("dplyr") to install package if needed</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span>
<span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span>
<span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simple-convergence-check">Simple Convergence Check<a class="anchor" aria-label="anchor" href="#simple-convergence-check"></a>
</h2>
<p>Check there are no params on bounds or SSB that is way too small or way too large</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_convergence</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">summary</span>, <span class="va">min_yr</span> <span class="op">=</span> <span class="fl">101</span>, <span class="va">max_yr</span> <span class="op">=</span> <span class="fl">120</span>, <span class="va">n_EMs</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># note: not the best way to do this</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">summary</span><span class="op">$</span><span class="va">scalar</span><span class="op">$</span><span class="va">params_on_bound</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Params on bounds"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"No params on bounds"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">summary</span><span class="op">$</span><span class="va">ts</span><span class="op">$</span><span class="va">model_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_EM_"</span>, <span class="va">summary</span><span class="op">$</span><span class="va">ts</span><span class="op">$</span><span class="va">model_run</span><span class="op">)</span>, <span class="st">"EM"</span>, <span class="st">"OM"</span><span class="op">)</span></span>
<span>  <span class="va">calc_SSB</span> <span class="op">&lt;-</span> <span class="va">summary</span><span class="op">$</span><span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="va">min_yr</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="va">max_yr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iteration</span>, <span class="va">scenario</span>, <span class="va">year</span>, <span class="va">model_run</span>, <span class="va">model_type</span>, <span class="va">SpawnBio</span><span class="op">)</span></span>
<span>  <span class="va">OM_vals</span> <span class="op">&lt;-</span> <span class="va">calc_SSB</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">model_type</span> <span class="op">==</span> <span class="st">"OM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>SpawnBio_OM <span class="op">=</span> <span class="va">SpawnBio</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iteration</span>, <span class="va">scenario</span>, <span class="va">year</span>, <span class="va">SpawnBio_OM</span><span class="op">)</span></span>
<span>  <span class="va">EM_vals</span> <span class="op">&lt;-</span> <span class="va">calc_SSB</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">model_type</span> <span class="op">==</span> <span class="st">"EM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>SpawnBio_EM <span class="op">=</span> <span class="va">SpawnBio</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iteration</span>, <span class="va">scenario</span>, <span class="va">year</span>, <span class="va">model_run</span>, <span class="va">SpawnBio_EM</span><span class="op">)</span></span>
<span>  <span class="va">bind_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">EM_vals</span>, <span class="va">OM_vals</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iteration"</span>, <span class="st">"scenario"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>SSB_ratio <span class="op">=</span> <span class="va">SpawnBio_EM</span> <span class="op">/</span> <span class="va">SpawnBio_OM</span><span class="op">)</span></span>
<span>  <span class="va">filter_SSB</span> <span class="op">&lt;-</span> <span class="va">bind_vals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SSB_ratio</span> <span class="op">&gt;</span> <span class="fl">2</span> <span class="op">|</span> <span class="va">SSB_ratio</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">filter_SSB</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Some large/small SSBs relative to OM"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"All SSBs in EM are no greater than double and no less than half SSB vals in the OM"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">return_val</span> <span class="op">&lt;-</span> <span class="va">bind_vals</span></span>
<span><span class="op">}</span></span>
<span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/check_convergence.html">check_convergence</a></span><span class="op">(</span>summary <span class="op">=</span> <span class="va">summary</span>, min_yr <span class="op">=</span> <span class="fl">101</span>, max_yr <span class="op">=</span> <span class="fl">106</span>, n_EMs <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## No params on bounds</span></span>
<span><span class="co">## All SSBs in EM are no greater than double and no less than half SSB vals in the OM</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-spawning-stock-biomass-ssb">Plot Spawning Stock Biomass (SSB)<a class="anchor" aria-label="anchor" href="#plot-spawning-stock-biomass-ssb"></a>
</h2>
<p>This plot shows that SSB estimated does not match perfectly with the operating model. A similar plot could be made for any parameter of interest.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot SSB by year and model run</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">summary</span><span class="op">$</span><span class="va">ts</span>, <span class="va">model_run</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cod_OM"</span>, <span class="st">"cod_SR_BH_steep_1_OM"</span>, <span class="st">"cod_EM_103"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">SpawnBio</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">100</span>, color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">iteration</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">model_run</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#D65F00"</span>, <span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"solid"</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">scenario</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead as</span></span>
<span><span class="co">## of ggplot2 3.3.4.</span></span>
<span><span class="co">## This warning is displayed once every 8 hours.</span></span>
<span><span class="co">## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span><span class="co">## generated.</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_SSB-1.png"><!-- --></p>
<p>Now, we calculate and plot the performance metric, which is average spawning stock biomass (SSB) from years 104 to 106.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get_SSB_avg calculates the SSB in each year for each</span></span>
<span><span class="co"># iteration of the operating model, then takes the average over the years from</span></span>
<span><span class="co"># min_yr, to max_year. It uses the summary object as input to do these</span></span>
<span><span class="co"># calculations.</span></span>
<span><span class="va">get_SSB_avg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">summary</span>, <span class="va">min_yr</span>, <span class="va">max_yr</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">OM_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">summary</span><span class="op">$</span><span class="va">ts</span><span class="op">$</span><span class="va">model_run</span><span class="op">)</span></span>
<span>  <span class="va">OM_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"_OM$"</span>, <span class="va">OM_vals</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">SSB_yr</span> <span class="op">&lt;-</span> <span class="va">summary</span><span class="op">$</span><span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="va">min_yr</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="va">max_yr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">model_run</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">OM_vals</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iteration</span>, <span class="va">scenario</span>, <span class="va">year</span>, <span class="va">SpawnBio</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">iteration</span>, <span class="va">scenario</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>avg_SSB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">SpawnBio</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"keep"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">SSB_yr</span></span>
<span><span class="op">}</span></span>
<span><span class="va">avg_SSB</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_SSB_avg.html">get_SSB_avg</a></span><span class="op">(</span><span class="va">summary</span>, min_yr <span class="op">=</span> <span class="fl">104</span>, max_yr <span class="op">=</span> <span class="fl">106</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># function to summarize data in plot</span></span>
<span><span class="va">data_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">ymin</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">ymax</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">m</span>, ymin <span class="op">=</span> <span class="va">ymin</span>, ymax <span class="op">=</span> <span class="va">ymax</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Now, plot the average relative spawning stock biomass for years 104 - 106</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">avg_SSB</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">scenario</span>, y <span class="op">=</span> <span class="va">avg_SSB</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="va">data_summary</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Long-term average  SSB\n(years 104-106)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Scenario"</span>, y <span class="op">=</span> <span class="st">"SSB"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_SSB_avg-1.png"><!-- --></p>
<p>From the above plot, we see differences in the average SSb between the 2 scenarios.</p>
</div>
<div class="section level2">
<h2 id="example-mse-results">Example MSE Results<a class="anchor" aria-label="anchor" href="#example-mse-results"></a>
</h2>
<p>We can see from the performance metric that mis-specifying the value of steepness will results in higher realized relative spawning stock biomass than correctly specifying it. This gives us some idea of the consequences of misspecifying steepness in the stock assessment.</p>
</div>
<div class="section level2">
<h2 id="delete-the-files">Delete the files<a class="anchor" aria-label="anchor" href="#delete-the-files"></a>
</h2>
<p>If you wish to delete the files created from this example, you can use:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">run_SSMSE_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="advanced-options-use-a-custom-management-strategyprocedure">Advanced options: use a custom management strategy/procedure<a class="anchor" aria-label="anchor" href="#advanced-options-use-a-custom-management-strategyprocedure"></a>
</h1>
<p>Users can outline a custom managment strategy as an R function to use. As long as the correct inputs and outputs are used, any estimation method and management procedure can be used. For example, here is a simple function that just sets future catches as half the sampled catches in a specified year:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">constant_catch_MS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">OM_dat</span>, <span class="va">nyrs_assess</span>, <span class="va">catch_yr</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                              <span class="va">frac_catch</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span> <span class="co"># need to include ... to allow function to work</span></span>
<span>  <span class="co"># set catch the same as the previous year (sampled catch).</span></span>
<span>  <span class="co"># catch is in the same units as the operating model, in this case it is in</span></span>
<span>  <span class="co"># biomass.</span></span>
<span>  <span class="va">catch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    year <span class="op">=</span> <span class="op">(</span><span class="va">OM_dat</span><span class="op">$</span><span class="va">endyr</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">OM_dat</span><span class="op">$</span><span class="va">endyr</span> <span class="op">+</span> <span class="va">nyrs_assess</span><span class="op">)</span>, <span class="co"># the years to project the model forward</span></span>
<span>    seas <span class="op">=</span> <span class="fl">1</span>, <span class="co"># hard coded from looking at model</span></span>
<span>    fleet <span class="op">=</span> <span class="fl">1</span>, <span class="co"># hard coded from looking at model</span></span>
<span>    catch <span class="op">=</span> <span class="va">OM_dat</span><span class="op">$</span><span class="va">catch</span><span class="op">[</span><span class="va">OM_dat</span><span class="op">$</span><span class="va">catch</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">catch_yr</span>, <span class="st">"catch"</span><span class="op">]</span> <span class="op">*</span> <span class="va">frac_catch</span>,</span>
<span>    catch_se <span class="op">=</span> <span class="fl">0.05</span></span>
<span>  <span class="op">)</span> <span class="co"># hard coded from looking at model</span></span>
<span>  <span class="va">catch_bio</span> <span class="op">&lt;-</span> <span class="va">catch</span> <span class="co"># catch in biomass. In this case, catch is in biomass for both. Could also be left as NULL</span></span>
<span>  <span class="va">catch_F</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># catch in terms of F, can be left as NULL.</span></span>
<span>  <span class="va">discards</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># discards can be left as NULL if there are no discards</span></span>
<span>  <span class="va">catch_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    catch <span class="op">=</span> <span class="va">catch</span>,</span>
<span>    catch_bio <span class="op">=</span> <span class="va">catch_bio</span>,</span>
<span>    catch_F <span class="op">=</span> <span class="va">catch_F</span>,</span>
<span>    discards <span class="op">=</span> <span class="va">discards</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The function should be created in a separate file. In this case, assume this function is available in a file custom_funs.R.</p>
<p>This function can then be used in a call to <code>run_SSMSE</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run_result_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_SSMSE.html">run_SSMSE</a></span><span class="op">(</span></span>
<span>  scen_name_vec <span class="op">=</span> <span class="st">"constant-catch"</span>, <span class="co"># name of the scenario</span></span>
<span>  out_dir_scen_vec <span class="op">=</span> <span class="va">run_res_path</span>, <span class="co"># directory in which to run the scenario</span></span>
<span>  iter_vec <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  OM_name_vec <span class="op">=</span> <span class="st">"cod"</span>, <span class="co"># specify directories instead</span></span>
<span>  OM_in_dir_vec <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  MS_vec <span class="op">=</span> <span class="st">"constant_catch_MS"</span>, <span class="co"># use the custom function</span></span>
<span>  custom_MS_source <span class="op">=</span> <span class="st">"custom_funs.R"</span>, <span class="co"># File where the custom function is available.</span></span>
<span>  nyrs_vec <span class="op">=</span> <span class="fl">6</span>, <span class="co"># Years to project OM forward</span></span>
<span>  nyrs_assess_vec <span class="op">=</span> <span class="fl">3</span>, <span class="co"># Years between assessments</span></span>
<span>  future_om_list <span class="op">=</span> <span class="va">future_om_list_recdevs_sel</span>,</span>
<span>  sample_struct_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">sample_struct_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="co"># How to sample data for running the MS.</span></span>
<span>  seed <span class="op">=</span> <span class="fl">12345</span></span>
<span><span class="op">)</span> <span class="co"># Set a fixed integer seed that allows replication</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="how-can-i-contribute-to-ssmse">How can I contribute to SSMSE?<a class="anchor" aria-label="anchor" href="#how-can-i-contribute-to-ssmse"></a>
</h1>
<p>Currently, feedback on how using SSMSE is working or not would be most hopeful! Please open an issue if a problem is found. The developers can also be contacted through <a href="https://github.com/nmfs-fish-tools/SSMSE/discussions" class="external-link">github discussions</a> or by emailing <a href="mailto:nmfs.stock.synthesis@noaa.gov" class="email">nmfs.stock.synthesis@noaa.gov</a>.</p>
<p>If you are interested in contributing, please read the <a href="https://github.com/nmfs-fish-tools/Resources/blob/master/CONTRIBUTING.md" class="external-link">NMFS Fisheries Toolbox R Contribution Guide</a>. This project and everyone participating in it is governed by the <a href="https://github.com/nmfs-fish-tools/Resources/blob/master/CODE_OF_CONDUCT.md" class="external-link">NMFS Fisheries Toolbox Code of Conduct</a>. By participating, you are expected to uphold this code.</p>
</div>
<div class="section level1">
<h1 id="roadmap-where-is-ssmse-headed-next">Roadmap: Where is SSMSE headed next?<a class="anchor" aria-label="anchor" href="#roadmap-where-is-ssmse-headed-next"></a>
</h1>
<p>SSMSE will be applied to a number of problems. If you are interested in using SSMSE, please don’t hesitate to reach out to the developers via <a href="https://github.com/nmfs-fish-tools/SSMSE/discussions" class="external-link">github discussions</a> or by emailing <a href="mailto:nmfs.stock.synthesis@noaa.gov" class="email">nmfs.stock.synthesis@noaa.gov</a>.</p>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/nmfs-fish-tools/SSMSE/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/nmfs-fish-tools/SSMSE/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>.md</li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing SSMSE</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kathryn Doering <br><small class="roles"> Author, maintainer </small>  </li>
<li>Nathan Vaughan <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kathryn Doering, Nathan Vaughan.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
