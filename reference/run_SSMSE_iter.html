<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="High level function to run 1 iteration of a scenario for a management
strategy evaluation using Stock Synthesis as the Operating model."><title>Run one iteration of an MSE using SS OM — run_SSMSE_iter • SSMSE</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Run one iteration of an MSE using SS OM — run_SSMSE_iter"><meta property="og:description" content="High level function to run 1 iteration of a scenario for a management
strategy evaluation using Stock Synthesis as the Operating model."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SSMSE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://nmfs-fish-tools.github.io/SSMSE/manual" aria-label="User Manual">User Manual</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nmfs-fish-tools/SSMSE/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Run one iteration of an MSE using SS OM</h1>
      <small class="dont-index">Source: <a href="https://github.com/nmfs-fish-tools/SSMSE/blob/HEAD/R/runSSMSE.R" class="external-link"><code>R/runSSMSE.R</code></a></small>
      <div class="d-none name"><code>run_SSMSE_iter.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>High level function to run 1 iteration of a scenario for a management
strategy evaluation using Stock Synthesis as the Operating model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_SSMSE_iter</span><span class="op">(</span></span>
<span>  out_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  OM_name <span class="op">=</span> <span class="st">"cod"</span>,</span>
<span>  OM_in_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  EM_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  EM_in_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  run_EM_last_yr <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  MS <span class="op">=</span> <span class="st">"last_yr_catch"</span>,</span>
<span>  custom_MS_source <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_SS_boot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  nyrs <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  nyrs_assess <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  nyrs_lag <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  nscen <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  scen_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  niter <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  iter_seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_struct <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  future_om_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_struct_hist <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_catch <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  interim_struct <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_F_search_loops <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  tolerance_F_search <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>out_dir</dt>
<dd><p>The directory to which to write output. IF NULL, will default
to the working directory.</p></dd>


<dt>OM_name</dt>
<dd><p>Name of the operating model (OM).</p></dd>


<dt>OM_in_dir</dt>
<dd><p>Relative or absolute path to the operating model, if using a
model outside of the SSMSE package. Should be a string.</p></dd>


<dt>EM_name</dt>
<dd><p>Name of a valid Stock Synthesis stock assessment model to use
as an EM. If the value of EM_name is NULL and  <code>MS = "EM"</code>, then SSMSE
will look for the estimation model in the path specified in EM_in_dir.
or <code>NULL</code>.</p></dd>


<dt>EM_in_dir</dt>
<dd><p>Relative or absolute path to the estimation model,</p></dd>


<dt>run_EM_last_yr</dt>
<dd><p>Should the MS be implemented to get future catch if the
last year is an assessment year? TRUE/FALSE option, so the same for all
scenarios and iterations. Defaults to FALSE.</p></dd>


<dt>MS</dt>
<dd><p>The management strategy to use. Current options
are:  <code>"last_yr_catch"</code> which uses the previous year's catch;
<code>"no_catch"</code> which uses 0 catch; <code>"EM"</code> which uses an stock
synthesis model as the estimation method and the management strategy as
defined in the forecast file of the stock synthesis estimation method;
<code>"Interim"</code> to modify catch based on survey predictions between
assessments. Users can also specify their own management strategies as a
function. For example, if the function is
called "my_ms" then the user should specify MS = "my_ms" and specify the
path to the file containing the function in <code>custom_MS_source</code>.</p></dd>


<dt>custom_MS_source</dt>
<dd><p>A file location with the source code for any custom MS
models to be used in the simulation. SSMSE will source this file which should
contain a function/s whose name/s match each custom MS models included in MS_vec.
To learn more about using custom management strategies, see the
<a href="https://nmfs-fish-tools.github.io/SSMSE/manual/custom-MS.html" class="external-link">using a Custom Management Stratey/Procedure section</a>
in the <a href="https://nmfs-fish-tools.github.io/SSMSE/manual" class="external-link">SSMSE User Manual</a>.</p></dd>


<dt>use_SS_boot</dt>
<dd><p>Should a bootstrapped data set generated by SS be used?
Defaults to TRUE.</p></dd>


<dt>nyrs</dt>
<dd><p>Number of years beyond the years included in the OM to run the
MSE. A single integer value.</p></dd>


<dt>nyrs_assess</dt>
<dd><p>The number of years between assessments. E.g., if an
assessment is conducted every 3 years, put 3 here. A single integer value.
(NOTE: we could make this more flexible by instead reading in a vector of
assessment years, so users could specify irregular numbers of yrs between
assessments.)</p></dd>


<dt>nyrs_lag</dt>
<dd><p>number of years of lag in obtaining data. i.e. the number of years
post EM assessment end yr before advice can be implemented. defaults to 0.</p></dd>


<dt>nscen</dt>
<dd><p>Which scenario is this. Integer value &gt;=1</p></dd>


<dt>scen_name</dt>
<dd><p>Name of the scenario. The directory containing all the model
runs the scenario will be stored within a folder of this name.</p></dd>


<dt>niter</dt>
<dd><p>The iteration number, which is also the name of the folder the
results will be written to.</p></dd>


<dt>iter_seed</dt>
<dd><p>List containing fixed seeds for this iteration.</p></dd>


<dt>sample_struct</dt>
<dd><p>A optional list including which years, seasons, and fleets
should be  added from the OM into the EM for different types of data.
If NULL, the data structure will try to be inferred from the pattern found
for each of the datatypes within the EM datafiles. Include this structure
for the number of years to extend the model out. Note that the data should
be specified using the list component names and column names as in would be
used in <code><a href="https://r4ss.github.io/r4ss/reference/SS_readdat.html" class="external-link">r4ss::SS_readdat()</a></code>. The <code>run_SSMSE_iter</code> function
examples give an example of what this structure should be. Running the
function <code><a href="create_sample_struct.html">create_sample_struct()</a></code> will also produce a sample_struct
object in the correct form. Can be NULL only when MS is not EM.</p></dd>


<dt>future_om_list</dt>
<dd><p>An optional list of lists including changes that should
be made after the end year of the input model. Each first level list element
outlines 1 change to be made to the operating model. To see an example, try
running <code><a href="create_future_om_list.html">create_future_om_list</a></code>. Defaults to NULL, which implies
that the model will be extended forward in time assuming the original model
structure.</p></dd>


<dt>sample_struct_hist</dt>
<dd><p>An optional list including which years should be
sampled for the historical period for the data generated from the OM. If
this is left as NULL, then the same sampling scheme will be used as in the
OM's data file. If it is not NULL, then each year.</p></dd>


<dt>sample_catch</dt>
<dd><p>Should catch be sampled or fixed at the OM values?
Defaults to FALSE.</p></dd>


<dt>interim_struct</dt>
<dd><p>A optional list of parameters to control an interim
assessment with an example structure below, where Beta=a positive value
that is inversely proportional to risk, MA_years= the number of years to
average index observations of when calculating deviations, assess_freq=the
number of years between full assessments during with an interim assessment
will happen every year, and Index_weights is a vector of length n indexes
that weights all indexes for multi index inference.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>interim_struct<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">Beta =</span> <span class="dv">1</span>,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>                     <span class="at">MA_years =</span> <span class="dv">3</span>,</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                     <span class="at">assess_freq =</span> <span class="dv">5</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>                     <span class="at">Index_weights =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">max</span>(ref_index[, <span class="dv">3</span>])))</span></code></pre><p></p></div></dd>


<dt>n_F_search_loops</dt>
<dd><p>Number of times to try to find an F that achieves the
catches input in the OM. Defaults to 20.</p></dd>


<dt>tolerance_F_search</dt>
<dd><p>How far apart the input catch and achieved
catch can be in tried to find an F that achieves the catch input in the
OM. Defaults to 0.001.</p></dd>


<dt>verbose</dt>
<dd><p>Want verbose output? Defaults to FALSE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Kathryn Doering &amp; Nathan Vaughan</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Create a temporary folder for the output</span></span></span>
<span class="r-in"><span><span class="va">temp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"run_SSMSE_iter-ex"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">temp_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run 1 iteration and 1 scenario of SSMSE</span></span></span>
<span class="r-in"><span><span class="fu">run_SSMSE_iter</span><span class="op">(</span></span></span>
<span class="r-in"><span>  OM_name <span class="op">=</span> <span class="st">"cod"</span>,</span></span>
<span class="r-in"><span>  MS <span class="op">=</span> <span class="st">"no_catch"</span>,</span></span>
<span class="r-in"><span>  out_dir <span class="op">=</span> <span class="va">temp_path</span>,</span></span>
<span class="r-in"><span>  nyrs <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  nyrs_assess <span class="op">=</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_path</span>, <span class="st">"1"</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># run 1 iteration and 1 scenario of SSMSE using an EM.</span></span></span>
<span class="r-in"><span><span class="fu">run_SSMSE_iter</span><span class="op">(</span></span></span>
<span class="r-in"><span>  OM_name <span class="op">=</span> <span class="st">"cod"</span>,</span></span>
<span class="r-in"><span>  MS <span class="op">=</span> <span class="st">"EM"</span>,</span></span>
<span class="r-in"><span>  out_dir <span class="op">=</span> <span class="va">temp_path</span>,</span></span>
<span class="r-in"><span>  EM_name <span class="op">=</span> <span class="st">"cod"</span>,</span></span>
<span class="r-in"><span>  nyrs <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  nyrs_assess <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  sample_struct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    catch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Yr <span class="op">=</span> <span class="fl">101</span><span class="op">:</span><span class="fl">106</span>, Seas <span class="op">=</span> <span class="fl">1</span>, FltSvy <span class="op">=</span> <span class="fl">1</span>, SE <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    CPUE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Yr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">102</span>, <span class="fl">105</span><span class="op">)</span>, Seas <span class="op">=</span> <span class="fl">7</span>, FltSvy <span class="op">=</span> <span class="fl">2</span>, SE <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    lencomp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      Yr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">102</span>, <span class="fl">105</span><span class="op">)</span>, Seas <span class="op">=</span> <span class="fl">1</span>, FltSvy <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>      Sex <span class="op">=</span> <span class="fl">0</span>, Part <span class="op">=</span> <span class="fl">0</span>, Nsamp <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    agecomp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      Yr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">102</span>, <span class="fl">105</span><span class="op">)</span>, Seas <span class="op">=</span> <span class="fl">1</span>, FltSvy <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>      Sex <span class="op">=</span> <span class="fl">0</span>, Part <span class="op">=</span> <span class="fl">0</span>, Ageerr <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>      Lbin_lo <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, Lbin_hi <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, Nsamp <span class="op">=</span> <span class="fl">50</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">temp_path</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Kathryn Doering, Nathan Vaughan.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

